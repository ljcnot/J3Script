local save_target
local target
local tclass
local this_player
local mbuff
local tbuffList
local ttarget
local ttclass
local ttbuffList
local gcdsj=0.2 --gcdÊ±¼ä
function ota(desc)
    local mota, motatime, motaratio = GetPrepare()
    return string.find(desc, mota)
end
function tota(desc)
    local mota, motatime, motaratio = GetPrepare(target)
    return string.find(desc, mota)
end
function objLife(obj)
    if obj == nil then
        return 999
    end
    local bfb = (obj.nCurrentLife / obj.nMaxLife) * 100
    return bfb
end

function life()
    if this_player == nil then
        return 999
    end
    local bfb = (this_player.nCurrentLife / this_player.nMaxLife) * 100
    return bfb
end
function tlife()
    if target == nil then
        return 999
    end
    local bfb = (target.nCurrentLife / target.nMaxLife) * 100
    return bfb
end
function ttlife()
    if ttarget == nil then
        return 999
    end
    local bfb = (ttarget.nCurrentLife / ttarget.nMaxLife) * 100
    return bfb
end
function face()
    if target == nil then
        return 999
    end
    return GetFace(target)
end
function isPositive()
    return face() >= 0 and face() <= 15
end
function buff(list)
    mbuff = GetBuff(this_player)
    return GetBuffTime(mbuff, list) > 0
end
function tbuff(list)
    tbuffList = GetBuff(target)
    return GetBuffTime(tbuffList, list) > 0
end
function bufftime(id)
    mbuff = GetBuff(this_player)
    return GetBuffTime(mbuff, id)
end
function skill(skillid)
    --print(skillid)
    Cast(skillid, false, false)
end
function skillEX(skillid)
    ---´ò¶Ïµ±Ç°¶ÁÌõ
    CastTo(skillid, target, true)
end
function skillEX2(skillid)
    ---´ò¶Ïµ±Ç°¶ÁÌõ
    Cast(skillid, true, true)
end
function dis()
    return GetDist(target)
end
function his()
    if target == nil or tclass == NPC then
        return 0
    end
    return GetHeight(target)
end
function dis2()
    return GetDist2D(target)
end
function ttdis()
    return GetDist(this_player, ttarget)
end

function rseeme(seeme)
    local seemecount, seemet = GetSeeMe(20)
    return seemecount
end

function state(desc)
    local tate = GetState(this_player)
    return string.find(desc, tate)
end
function tstate(desc)
    if target == nil then
        return false
    end
    local tstate = GetState(target)
    return string.find(desc, tstate)
end
function mount(desc)
    local school = GetMount(this_player)
    --print(school)
    return string.find(desc, school)
end
function tmount(desc)
    if tclass == NPC then
        return false
    end

    local school = GetMount(target)
    --print(school)
    if school == nil then
        return false
    end
    return string.find(desc, school)
end

function statep(desc)
    --print(desc)
    return GetTypeTime(mbuff, desc) > 0
end

function ttstatep(desc)
    if ttarget == nil then
        return false
    end
    return GetTypeTime(ttbuffList, desc) > 0
end

function tstatep(desc)
    if target == nil then
        return false
    end
    --print(desc)
    return GetTypeTime(tbuffList, desc) > 0
end
function tstate(desc)
    if target == nil then
        return false
    end
    local tstate = GetState(target)
    return string.find(desc, tstate) ~= nil
end
function objState(obj, desc)
    if obj == nil then
        return false
    end
    local tstate = GetState(obj)
    return string.find(desc, tstate) ~= nil
end
function ttstate (desc)
    if ttarget == nil then
        return false
    end
    local tstate = GetState(ttarget)
    return string.find(desc, tstate) ~= nil
end
function tnostate(desc)
    if target == nil then
        return false
    end
    local tstate = GetState(target)
    return string.find(desc, tstate) == nil
end
function CastTime(skillid, time)
    if target == nil then
        return false
    end
    return GetCastTime(target, skillid) > 0 and GetCastTime(target, skillid) <= time
end
function objNotWudi(obj)
    local wudi = { 203, 9695, 10212, 9934, 377 }
    for k, v in ipairs(wudi) do
        if obj.IsHaveBuff(v, 0) then
            return false
        end

    end
    return true
end

function isManri()
    ---ÅÐ¶ÏÊÇ·ñÂúÈÕ
    return this_player.nSunPowerValue>0
end
function isManyue()
    ---ÅÐ¶ÏÊÇ·ñÂúÔÂ
    return this_player.nMoonPowerValue>0
end
function getSun()
    ---»ñÈ¡ÈÕÁé
    return (this_player.nCurrentSunEnergy/100)
end
function getMoon()
    ---»ñÈ¡ÔÂÁé
    return (this_player.nCurrentMoonEnergy/100)
end
---È¨ÖØ¼ÆËã
function getWeight()
    --»ñÈ¡×Ô¼ºµÄbuffÊý¾Ý
    --local mbuff = GetBuff(player)
    --»ñÈ¡Ä¿±êµÄbuffÊý¾Ý
    --local tbuffList = GetBuff(target)

    local wudi = "ÕòÉ½ºÓ|Æ½É³ÂäÑã|¹í¸«Éñ¹¤|É¢Á÷Ï¼|Áý»¨|¶ÜÁ¢|ÄÏ·çÍÂÔÂ|Ð¦×í¿ñ|Ì«Ðé|Á¦Íì¿ñÀ½|Ð¥Èç»¢|Ô¡»ð|²»¶¯|Ê´ÐÄ¹Æ"
    local jianshang80 = "9696|7119|368|10307"
    --Çå¾øÓ°¸è ÂÖ»Ø ÊØÈçÉ½ Ð¦°Á¹âÒõ
    local jianshang70 = "8421|10493|1802|384"
    --¼áÈÍ ÎÞÏà¾ö ÓùÌì ×ªÇ¬À¤
    local jianshang60 = "6264|11319|8300|13044|9836|9206|6200"
    --´ºÄà»¤»¨ ÁÙÔ¨µ¸ºÓ ¶ÜÇ½ ÎÞÏà¾÷ Ä¦ßÒ Íòô¥Ö®¼Å  ÁúÐ¥¾ÅÌì
    local jianshang50 = "9810|6315|10014|8427|9803|6306|2983|1412|3068"
    --ÉáÉí ÁãÂä ¾ø¸è ÈÙ»Ô ÎÞÏà¾÷ ¹âÃ÷Ïà ÎÞÎÒ ÒÙÁ¢²»µ¹ ÎíÌå
    local jianshang40 = "9873|2953|1187|399|9693|6279|11920|8839|6637|6636|6257|5744|6163|9874|9293|12530|122|6240|12656|9208|8495|6248"
    --Ò·¹â Ê¥ÊÖÖ¯Ìì Î÷×Ú ÎÞÏà¾ö Çå¾øÓ°¸è Ì°Ä§Ìå ´ºÄà»¤»¨ Ê¥ÊÖÖ¯Ìì Ê¥ÊÖÖ¯Ìì Ê¥ÊÖÖ¯Ìì ´ºÄà»¤»¨ Ì°Ä§Ìå ÊØÈçÉ½ É¢Ó° ²ÐÓ° ³ËÁúÏ·Ë® ´ºÄà»¤»¨ ÐþË®¹Æ Ë®é¿»¨Ó¯ Íòô¥Ö®¼Å º´ÎÀ ¿Ý²Ð¹Æ
    local jianshang30 = "9510|11457|9895|9745|9896|8302|12286|2177|10051|9510|5641|6262|6160|5806|5705|2813|6247"
    --ÇàÏö·ÉÓð Ò×Ë® Ö¾³ê ³¯Ê¥ ¶ÜÎè ËàÁÐ ×óÐýÓÒ×ª Õý¹Ç ±­Ë®ÁôÓ° ÇàÏö·ÉÓð ½ð¼× ½ðÎÝ À×ÐÄ ´óÃ÷ ÉáÉí Ëæ·ç ¹ÆÓ°
    local jianshang20 = "2983|7790|7171|6378|6209|5746"
    --ÎÞÎÒ ÁúÕ½ ÉÆ»¤ Ñ±ÖÂ ÎÞÏà¾ö Á÷¹âÇôÓ°
    local jianshang10 = "11272|9904|9763|11344|6333|6610|5750|10024|12411|8424|6540|6337|6237|5770|4479|6113"
    --³õÊì µþÈª ´º´Ç ´º´Ç ÉÏ½«¾üÓ¡ ×Ýºá ¹éÈ¥À´ ¹é¼ÅµÀ ôÂôÄ ³ËÁúÏ·Ë® ¼á¶¨ ¹éÉ½ Õê»¤ Ê¥Ó¿ ÌÒ½© ÕÛ³å Ç§»úÉñËÙ
    local miankong = "ÆÐÌáÉí|ÇàÑô|Í»|ÁãÂä|Ð¦×í¿ñ|³öÔ¨|ÍÌÈÕÔÂ|ÁúÔ¾ÓÚÔ¨|¹Æ³æÏ×¼À|±ÌµûÏ×¼À|·çòÚÏ×¼À|²»¹¤|Á¦°Î|·Éð°ÖðÔÂ|ÃØÓ°|¸¡¿Õ|¸¡¿Õ|ÐÇÂ¥ÔÂÓ°|¹éº¨|ËØñÆ|³¬È»|Áé»Ô|ÉúËÀÖ®½»|ËØñÆ|Ð¥ÈÕ|ÐÇÂ¥ÔÂÓ°|×ªÇ¬À¤|×ªÇ¬À¤|Ê¥Ìå|Á÷»ð·ÉÐÇ|¿íÒ°|°ÔÌå|Ç§½ï×¹|ÐëÃÖ|ÑÌÓêÐÐ|°ÔÌå|¾ÆÖÐÏÉ|×ÝÇáÆï|ÈÎ³Û³Ò|ÉúÌ«¼«|ÉúÌ«¼«|ÐÐÌìµÀ|¹Æ³æ¿ñ±©|ËÉÑÌÖñÎí¡¤miankong|¶·ÊÒÎÞ³¾|¶·ÊÒÎÞ³¾|µ·ÒÂ|Ê¯¼äÒâ|³¾Éí|³¾Éí|ÆÆÖØÎ§|ÒôÔÏ|Ì½Ã·|µ·ÒÂ|¹ÂÓ°|¾»¹û|º´ÎÀ|½Ù»¯|Î÷³þ±¯¸è|¶ÜÇ½|¾øÂ×ÒÝÈº|Ç§µûÍÂÈð|¶ÜÒã|Ç§ÏÕ|ÎÞ¾å|ÈµÌ¤Ö¦|ÈµÌ¤Ö¦|ÈµÌ¤Ö¦|ÈµÌ¤Ö¦|ÈµÌ¤Ö¦|ÈµÌ¤Ö¦|ÈµÌ¤Ö¦|ÈµÌ¤Ö¦|ÈµÌ¤Ö¦|³¾Éí|ÆÆÔÂ|ÇàÏö·ÉÓð|¸¡¿Õ|ÇàµÙ|Ë®ÔÂÎÞ¼ä|ÕÛ¹Ç|Ê´ÐÄ¹Æ|ÓñÈªÓãÔ¾|¹ÆÓ°|ÊÉ¹Æ|ÃâÒß¿ØÖÆ|ÇàÏö·ÉÓð|¶ÝÓ°"
    local shanbi80 = "10619|9846|9783"
    --ÎíÓê|¾ªºèÓÎÁú ÈµÌ¤Ö¦
    local shanbi60 = "6434|9783|5668|9736"
    --×íåÐÒ£ ÈµÌ¤Ö¦ ·ç´µºÉ ´È±¯Ô¸

    local shanbi50 = "2065|6299|8866|677"
    --ÔÆÏ¡ËÉ Óù·ç¶øÐÐ ÈµÌ¤Ö¦ ÈµÌ¤Ö¦
    local shanbi40 = "6174|4028|10618"
    --Á½Éú Ê¥ÔÂÓÓ ÎíÓê
    local shanbi30 = "4931|6146"
    --Áú»Ú ÈÕÉý
    local shanbi20 = "4710|6142|3310|948"
    --¿õ½Ù ±ùÌì ÓÎÁú »¨ÔÂÁè·çÁùÕó
    local shanbi10 = "857|10465|6289|10617"
    --ÉÁ¶ã ÄñÏè±Ì¿Õ ´È±¯ ÎíÓê

    local fengnei = { "°ËØÔ¶´Ðþ|ÇÀÖéÊ½|ØÊÒõÖ¸|º®ÔÂÒ«|ÇåÒô³¤Ð¥|Ã·»¨Õë|ÆàÇÐ|ó¸Ð¥¶áÃü|ó¸Ð¥¿Ý²Ð|ó¸Ð¥ÃÔÐÄ|ó¸Ð¥ÃÔÐÄ|²øÖñ|½£ÆÆÐé¿Õ|³ÁÄ¬|À×öªÕðÅ­" }
    local chenmo = "À×ÔÆ|½£·É¾ªÌì|À¼´ÝÓñÕÛ|³ÁÄ¬|½£·É¾ªÌì|Ö¹Ï¢|¾®ÒÇ|³ÁÄ¬|·çÇÐ|½£ÐÄÍ¨Ã÷|ÕðÉå"
    local jianliao = "»î¼À|½ûÁÆ|Ï¢ÁÆ|Çå¾øÓ°¸è|ÐþÒ»|¶Ü»÷|µØÁú×ê|¼õÁÆ|ÉñÁú½µÊÀ|´©ÐÄåó|Åùö¨|Ð«ÕÝ|ºãºÓ½ÙÉ³|³¾Ï¢|ÍÌ³þ|°Ù×ã¶áÃü|°Ù×ã¿Ý²Ð|°Ù×ãÃÔÐÄ|³þ¼Ã|Çå¾øÓ°¸è"
    local jidao = { "¸î¾ÝÇØ¹¬|Ì¤ÑçÑïÆì|»÷µ¹" }
    local suozu = { "ÇÜÁú|¶³ÍÁ|¸î¾ÝÇØ¹¬|ÖðÐÇ¼ý|ÇÙÒô|¸´Õ÷|ÎïÎÒ|Ó°Óü|ÖÓÁÖØ¹Ðã|½£¡¤Óð|ÂäÑã|ÖÍ|Îå·½ÐÐ¾¡|Ëé±ù|°Ù×ã|Ì«ÒõÖ¸|½û¸¿|·üÒ¹¡¤²ø|Á÷¹âÇôÓ°|ÓÄÔÂ|Ê¥Ð«Ï×¼À|ë¾×ã|Ìú×¦|¿×È¸ôá|ÐäÊÖ|ÌìÖëÏ×¼À|Ó°ÖÍ|°Ù×ã¶áÃü|°Ù×ã¿Ý²Ð|°Ù×ãÃÔÐÄ|Îå·½ÐÐ¾¡|Èý²Å»¯Éú|ÍÂ¹ÊÄÉÐÂ|ÈÆ×ã|Ö¹Ë®|Ó°ºÛ|Ëø×ã" }
    local dingshen = { "²øÐÄ|µã²Ô|¶¨Éí|ÎÞÖú|°²»¼|½ðÕë|Ìì¾øµØÃð|ÃÔÓ°|´óµÀÎÞÊõ|·üÒ¹¡¤¶¨|Ë¿Ç£|»Ã¹Æ|ç­´½ÖéÐä|ËÉÌÎ|Í¬¹é|ÆÆÊÆ|Ì«ÒõÖ¸|Íê¹Ç|µÛæîÁúÏè|°ø»¨ËæÁø|Ü½ÈØ²¢µÙ|ÆßÐÇ¹°Èð|ÓàÒô|»Ã¹Æ|¶¨Éí|½£ÉñÎÞÎÒ|´óµÀÎÞÊõ" }
    local yunxuan = { "Ñ£ÔÎ|Ç§½ï×¹|²Ã¹Ç|¸î¾ÝÇØ¹¬|ÃÔÉñ¶¤|±¡·¥|¹áÄ¾Á÷»ª|ÎÞÃû»êËø|¶ÜÃÍ|¶ÜÒã|º³µØ|×íåÐÒ£|¾»ÊÀÆÆÄ§»÷|»Ã¹â²½|»¢êÚ|åó»÷|ÉÆ»¤|ÕòÄ§|·üÒ¹¡¤ÔÎ|ÖØÉË|À×Õð×Ó|ÈÕÓ°|½£³åÒõÑô|±±¶·|Ð«ÐÄ¶áÃü|Ð«ÐÄ¿Ý²Ð|Ð«ÐÄÃÔÐÄ|¶Ï»ê´Ì|±ÌÍõ|º×¹é¹ÂÉ½|Î£Â¥|×íÔÂ|µ±Í·Ò»ÇÃ|ÖÐ×¢|ÆÆ¼áÕó|Ð«¶¾Õë|ÕðÉå|´óÊ¨×Óºð|ÎåÔÌ½Ô¿Õ|Í»|Õ½ºðÑ£ÔÎ|×·»ê|ÈÕ½Ù|·å²åÔÆ¾°|±À" }
    local jiaoxie = "¸¡ÔÆ|Ï¼Á÷|²ÀÎ·°µÐÌ|½ÉÐµ"
    local youxian3 = { "²¹Ìì¾÷", "»¨¼äÓÎ", "ÏàÖª" }
    local youxian2 = { "ÄªÎÊ", "·ÙÓ°Ê¥¾ö", "¾ªÓð¾÷", "ÌìÂÞ¹îµÀ", "°ÁÑªÕ½Òâ", "×ÏÏ¼¹¦", "Ð¦³¾¾ö" }
    local youxian1 = { "Àë¾­Ò×µÀ", "ÔÆÉÑÐÄ¾­", "Ì«Ðé½£Òâ", "±ùÐÄ¾÷" }

    local weight = 10
    --OutputinGame("---------------------------------")
    if GetBuffTime(tbuffList, wudi) > 0 then
        weight = weight + 100
    end
    if tstatep("ÎÞµÐ") then
        --Èç¹ûÄ¿±ê¿É¿ØÖÆ
        weight = weight + 100
    end
    if tstatep("²»ËÀ") then
        --Èç¹ûÄ¿±ê¿É¿ØÖÆ
        weight = weight + 100
    end
    if GetBuffTime(tbuffList, wudi) > 0 then
        weight = weight + 100
    end
    if GetBuffTime(tbuffList, jianshang80) > 0 then
        weight = weight + 8
        --OutputinGame("jianshang80")
    end
    if GetBuffTime(tbuffList, jianshang70) > 0 then
        weight = weight + 7
        --OutputinGame("jianshang70")
    end
    if GetBuffTime(tbuffList, jianshang60) > 0 then
        weight = weight + 6
        --OutputinGame("jianshang60")

    end
    if GetBuffTime(tbuffList, jianshang50) > 0 then
        weight = weight + 5
        --OutputinGame("jianshang50")
    end
    if GetBuffTime(tbuffList, jianshang40) > 0 then
        weight = weight + 4
        --OutputinGame("jianshang40")
    end
    if GetBuffTime(tbuffList, jianshang30) > 0 then
        weight = weight + 3
        --OutputinGame("jianshang30")
    end
    if GetBuffTime(tbuffList, jianshang20) > 0 then
        weight = weight + 2
        --OutputinGame("jianshang20")
    end
    if GetBuffTime(tbuffList, jianshang10) > 0 then
        weight = weight + 1
        --OutputinGame("jianshang10")
    end
    --if GetBuffTime(tbuffList, shanbi80) > 0 then
    --    weight = weight + 8
    --    --OutputinGame("shanbi80")
    --end
    --if GetBuffTime(tbuffList, shanbi60) > 0 then
    --    weight = weight + 6
    --    --OutputinGame("shanbi60")
    --end
    --if GetBuffTime(tbuffList, shanbi50) > 0 then
    --    weight = weight + 5
    --    --OutputinGame("shanbi50")
    --end
    --if GetBuffTime(tbuffList, shanbi40) > 0 then
    --    weight = weight + 4
    --    --OutputinGame("shanbi40")
    --end
    --if GetBuffTime(tbuffList, shanbi30) > 0 then
    --    weight = weight + 3
    --    --OutputinGame("shanbi30")
    --end
    --if GetBuffTime(tbuffList, shanbi20) > 0 then
    --    weight = weight + 2
    --    --OutputinGame("shanbi20")
    --end
    --if GetBuffTime(tbuffList, shanbi10) > 0 then
    --    weight = weight + 1
    --    --OutputinGame("shanbi10")
    --end

    if GetBuffTime(tbuffList, jianliao) > 0 then
        weight = weight - 3
        --OutputinGame("shanbi10")
    end
    if tstatep("³ÁÄ¬") then
        --Èç¹ûÄ¿±ê¿É¿ØÖÆ
        weight = weight - 3
    end
    if tstatep("½ÉÐµ") then
        --Èç¹ûÄ¿±ê¿É¿ØÖÆ
        weight = weight - 3
    end
    if tstatep("·âÄÚ") then
        --Èç¹ûÄ¿±ê¿É¿ØÖÆ
        weight = weight - 3
    end
    if tstatep("½ûÁÆ") then
        --Èç¹ûÄ¿±ê¿É¿ØÖÆ
        weight = weight - 3
    end
    if tstatep("¶¨Éí") then
        --Èç¹ûÄ¿±ê¿É¿ØÖÆ
        weight = weight - 1
    end
    if tstatep("Ñ£ÔÎ") then
        --Èç¹ûÄ¿±ê¿É¿ØÖÆ
        weight = weight - 1
    end
    if tstatep("»÷µ¹") then
        --Èç¹ûÄ¿±ê¿É¿ØÖÆ
        weight = weight - 2
    end
    --if GetBuffTime(tbuffList,chenmo) then
    --	weight = weight -3
    --	--OutputinGame("shanbi10")
    --end
    if tlife() < 10 then
        weight = weight - 10
    end
    if tlife() >= 10 and tlife() < 20 then
        weight = weight - 9
    end
    -- Output("5")
    if tlife() >= 20 and tlife() < 30 then
        weight = weight - 8
    end
    -- Output("6")
    if tlife() >= 30 and tlife() < 40 then
        weight = weight - 7
    end
    -- Output("7")
    if tlife() >= 40 and tlife() < 50 then
        weight = weight - 6
    end
    -- Output("8")
    if tlife() >= 50 and tlife() < 60 then
        weight = weight - 5
    end
    if tlife() >= 60 and tlife() < 70 then
        weight = weight - 4
    end
    if tlife() >= 70 and tlife() < 80 then
        weight = weight - 3
    end
    if tlife() >= 80 and tlife() < 90 then
        weight = weight - 2
    end
    if tlife() >= 90 and tlife() < 100 then
        weight = weight - 1
    end

    return weight
end





--function duobi()
--	local jineng= {"À×Õð×Ó" , "ÉúËÀ½Ù" , "º³µØ" , "Ç§½ï×¹" , "¼²" , "ÆßÐÇ¹°Èð" , "ÁúÔ¾ÓÚÔ¨" , "ÁúÕ½ÓÚÒ°" , "°ô´ò¹·Í·" , "¶ÜÃÍ" , "Í»" , "½£³åÒõÑô" , "·âÔ¨ÕðÉ·" , "ÇÜÍõÁùÊ½" , "¸î¾ÝÇØ¹¬" , "¶Ï»ê´Ì" , "×íÔÂ" , "¾ªÌÎ"}
--	for key, value in ipairs(jineng)
--	do
--		if rlast(value, "µÐ¶Ô", 1) then
--			return true
--		end
--		if isme() and tlast(value, 1) then			--Èç¹ûÄ¿±êµÄÄ¿±êÊÇÎÒ
--			return true
--		end
--	end
--	return false
--end
---½ÉÐµÊ±¼ä
function jiaoxieTime()
    tbuffList = GetBuff(target)
    local time = GetTypeTime(tbuffList, "½ÉÐµ")
    if time then
        return time
    end
    return 0
end
---Ñ£ÔÎÊ±¼ä
function yunxuanTime()
    tbuffList = GetBuff(target)
    local time = GetTypeTime(tbuffList, "Ñ£ÔÎ")
    if time then
        return time
    end
    return 0
end
---¶¨ÉíÊ±¼ä
function dingshenTime()
    tbuffList = GetBuff(target)
    local time = GetTypeTime(tbuffList, "¶¨Éí")
    if time then
        return time
    end
    return 0
end
---Ëø×ãÊ±¼ä
function suozuTime()
    tbuffList = GetBuff(target)
    local time = GetTypeTime(tbuffList, "Ëø×ã")
    if time then
        return time
    end
    return 0
end
---»÷µ¹Ê±¼ä
function jidaoTime()
    tbuffList = GetBuff(target)
    local time = GetTypeTime(tbuffList, "»÷µ¹")
    if time then
        return time
    end
    return 0
end
---¼õÁÆÊ±¼ä
function jianliaoTime()
    tbuffList = GetBuff(target)
    local time = GetTypeTime(tbuffList, "¼õÁÆ")
    if time then
        return time
    end
    return 0
end
---·âÄÚÊ±¼ä
function fengneiTime()
    tbuffList = GetBuff(target)
    local time = GetTypeTime(tbuffList, "·âÄÚ")
    if time then
        return time
    end
    return 0
end
---³ÁÄ¬Ê±¼ä
function chenmoTime()
    tbuffList = GetBuff(target)
    local time = GetTypeTime(tbuffList, "³ÁÄ¬")
    if time then
        return time
    end
    return 0
end

function cdEX(skill)
    ---Í¨¹ýÒÑ¾­ÊÍ·ÅµÄ¼¼ÄÜÊ±¼äÀ´ÅÐ¶Ï¼¼ÄÜÊÇ·ñcd
    --if skill()
    print(skill)
    return GetSkillSCD(skill) > 0
end
function cdEX2(skill)
    ---³äÄÜ¼¼ÄÜÅÐ¶Ï
    return GetSkillCN(skill) == 0
end

function kongzhiTimeEX(time)
    --print(time)
    return dingshenTime() >= time or yunxuanTime() >= time or jidaoTime() >= time
end
function jiekongTimeEX(time)
    return (dingshenTime() > 0 and dingshenTime() < time) or (yunxuanTime() > 0 and yunxuanTime() < time) or (jidaoTime() > 0 and jidaoTime() < time)
end
function jiekongTimeEX2(time)
    ---½Ó¿ÕÊ±¼ä²»´ø»÷µ¹
    return (dingshenTime() > 0 and dingshenTime() < time) or (yunxuanTime() > 0 and yunxuanTime() < time)
end
function jiekongTimeEX3(time)
    ---½Ó¿ÕÊ±¼äÖ»ÓÐ¶¨Éí
    return (dingshenTime() > 0 and dingshenTime() < time)
end
---²»ÄÜ¶ª¼¼ÄÜµÄÊ±¼ä
function noSkillTime(time)
    return (fengneiTime() > 0 and fengneiTime() > time) or (chenmoTime() > 0 and chenmoTime() > time) or (jiaoxieTime() > 0 and jiaoxieTime() > time)
end
function toBack()
    ---×Ô¶¯ÈÆ±³
    if GetDist(target) < 2 then
        if IsBack(target) then
            MoveForwardStop()
        else
            MoveForwardStart()
        end
    end
end

function findTarget(outTarger)
    ---ÊÇ·ñÅÅ³ýµ±Ç°Ä¿±ê
    ---Ñ°ÕÒÊÊºÏµÄÄ¿±ê
    local players = GetAllPlayer()
    local lastTar = nil
    local lastWeight = 100
    for k, v in ipairs(players) do
        --vÊÇÍæ¼Ò¶ÔÏó
        local weight = 10
        if IsPlayer(v.dwID) and IsEnemy(v) and IsDangerArea(v, "µÐ¶Ô") == false and GetDist(this_player, v) < 20 and IsVisible(this_player, v) and v.IsHaveBuff(9695, 0) == false and v.IsHaveBuff(10212, 0) == false then
            --Èç¹û²»ÊÇÎÒ
            if outTarger == false or v ~= target then
                ---Èç¹ûÐèÒªÅÅ³ýµ±Ç°Ä¿±ê
                if objLife(v) == 0 or objState(v, "ÖØÉË") then
                    weight = weight + 100
                end
                if objLife(v) > 80 and objLife(v) <= 90 then
                    weight = weight - 1
                end
                if objLife(v) > 70 and objLife(v) <= 80 then
                    weight = weight - 2
                end
                if objLife(v) > 60 and objLife(v) <= 70 then
                    weight = weight - 3
                end
                if objLife(v) > 50 and objLife(v) <= 60 then
                    weight = weight - 4
                end
                if objLife(v) > 40 and objLife(v) <= 50 then
                    weight = weight - 5
                end
                if objLife(v) > 30 and objLife(v) <= 40 then
                    weight = weight - 6
                end
                if objLife(v) > 20 and objLife(v) <= 30 then
                    weight = weight - 7
                end
                if objLife(v) > 10 and objLife(v) <= 20 then
                    weight = weight - 8
                end
                if objLife(v) > 0 and objLife(v) <= 10 then
                    weight = weight - 9
                end
                if objState(v, "Ñ£ÔÎ|»÷µ¹|½©Ö±|¶¨Éí") then
                    weight = weight - 3
                end
                if lastWeight > weight then
                    lastWeight = weight
                    lastTar = v
                end
            end
        end
    end
    ---Èç¹û±éÀúµÄÄ¿±ê²»µÈÓÚnil
    if lastTar ~= nil then
        SetTarget(lastTar)
    end
end
function findTargetforHp(hp)
    ---»ñÈ¡Ö¸¶¨ÑªÁ¿µÄµÐ¶ÔÄ¿±ê

    ---Ñ°ÕÒÊÊºÏµÄÄ¿±ê
    local players = GetAllPlayer()
    local lastTar = nil
    local lastWeight = 100
    for k, v in ipairs(players) do
        --vÊÇÍæ¼Ò¶ÔÏó
        local weight = 10
        if IsPlayer(v.dwID) and IsEnemy(v) and IsDangerArea(v, "µÐ¶Ô") == false and GetDist(this_player, v) < 20 and IsVisible(this_player, v) and objLife(v) < hp and v.IsHaveBuff(203, 0) == false and v.IsHaveBuff(9695, 0) == false and v.IsHaveBuff(10212, 0) == false then
            --Èç¹û²»ÊÇÎÒ
            if objLife(v) == 0 or objState(v, "ÖØÉË") then
                weight = weight + 100
            end
            if objLife(v) > 80 and objLife(v) <= 90 then
                weight = weight - 1
            end
            if objLife(v) > 70 and objLife(v) <= 80 then
                weight = weight - 2
            end
            if objLife(v) > 60 and objLife(v) <= 70 then
                weight = weight - 3
            end
            if objLife(v) > 50 and objLife(v) <= 60 then
                weight = weight - 4
            end
            if objLife(v) > 40 and objLife(v) <= 50 then
                weight = weight - 5
            end
            if objLife(v) > 30 and objLife(v) <= 40 then
                weight = weight - 6
            end
            if objLife(v) > 20 and objLife(v) <= 30 then
                weight = weight - 7
            end
            if objLife(v) > 10 and objLife(v) <= 20 then
                weight = weight - 8
            end
            if objLife(v) > 0 and objLife(v) <= 10 then
                weight = weight - 9
            end
            if objState(v, "Ñ£ÔÎ|»÷µ¹|½©Ö±|¶¨Éí") then
                weight = weight - 3
            end
            if lastWeight > weight then
                lastWeight = weight
                lastTar = v
            end
        end
    end
    ---Èç¹û±éÀúµÄÄ¿±ê²»µÈÓÚnil
    if lastTar ~= nil then
        print("Ñ¡Ôñ40%ÑªµÄÄ¿±ê")
        SetTarget(lastTar)
    end
end

function findTargetforRange(range)
    ---»ñÈ¡Ö¸¶¨·¶Î§ÄÚµÄµÐ¶ÔÄ¿±ê
    ---range  ·¶Î§
    if range == nil then
        return nil
    end
    ---Ñ°ÕÒÊÊºÏµÄÄ¿±ê
    local players = GetAllPlayer()
    local lastTar = nil
    local lastWeight = 100
    for k, v in ipairs(players) do
        --vÊÇÍæ¼Ò¶ÔÏó
        local weight = 10
        if IsPlayer(v.dwID) and IsEnemy(v) and IsDangerArea(v, "µÐ¶Ô") == false and GetDist(this_player, v) < range and IsVisible(this_player, v) and v.IsHaveBuff(9695, 0) == false and v.IsHaveBuff(10212, 0) == false then
            --Èç¹û²»ÊÇÎÒ
            if objLife(v) == 0 or objState(v, "ÖØÉË") then
                weight = weight + 100
            end
            if objLife(v) > 80 and objLife(v) <= 90 then
                weight = weight - 1
            end
            if objLife(v) > 70 and objLife(v) <= 80 then
                weight = weight - 2
            end
            if objLife(v) > 60 and objLife(v) <= 70 then
                weight = weight - 3
            end
            if objLife(v) > 50 and objLife(v) <= 60 then
                weight = weight - 4
            end
            if objLife(v) > 40 and objLife(v) <= 50 then
                weight = weight - 5
            end
            if objLife(v) > 30 and objLife(v) <= 40 then
                weight = weight - 6
            end
            if objLife(v) > 20 and objLife(v) <= 30 then
                weight = weight - 7
            end
            if objLife(v) > 10 and objLife(v) <= 20 then
                weight = weight - 8
            end
            if objLife(v) > 0 and objLife(v) <= 10 then
                weight = weight - 9
            end
            if objState(v, "Ñ£ÔÎ|»÷µ¹|½©Ö±|¶¨Éí") then
                weight = weight - 3
            end
            if lastWeight > weight then
                lastWeight = weight
                lastTar = v
            end
        end
    end
    ---Èç¹û±éÀúµÄÄ¿±ê²»µÈÓÚnil
    if lastTar ~= nil then
        SetTarget(lastTar)
    end
end

--Mainº¯Êý£¬1¸ö²ÎÊýÊÇ×Ô¼ºµÄÍæ¼Ò¶ÔÏó£¬Ã¿Ãëµ÷ÓÃ16´Î
function Main(player)
    this_player = player
    mbuff = GetBuff(player)
    target, tclass = GetTarget(player)
    if target ~= nil then
        tbuffList = GetBuff(target)
        ttarget, ttclass = GetTarget(target)
        if ttarget ~= nil then
            ttbuffList = GetBuff(ttarget)
        end
        local weight=getWeight()
        --print("weight:",weight)
        tab(weight)
        --¸úËæµ±Ç°Ä¿±ê
        FollowTarget()
        toBack()
        TurnTo(target)
        --if GetHeight(player)>0 then
        --	Jump()
        --end
        DPS(weight)
    end
end